<!doctype html>
<html lang="uk">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Карта: українські автори — художній стиль</title>

  <!-- Leaflet CSS -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
        integrity="sha512-somehash" crossorigin=""/>

  <style>
    html,body,#map { height:100%; margin:0; padding:0; }
    body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial; }
    #map { position:fixed; inset:0; }
    .marker-img {
      width:54px;
      height:54px;
      border-radius:50%;
      object-fit:cover;
      box-shadow: 0 2px 8px rgba(0,0,0,0.35);
      border: 3px solid rgba(255,255,255,0.85);
      background: linear-gradient(180deg, rgba(255,255,255,0.05), rgba(0,0,0,0.03));
    }
    .popup-card {
      width:220px;
      font-size:14px;
    }
    .popup-title { font-weight:700; margin-bottom:6px; }
    .goto-btn {
      display:inline-block;
      margin-top:8px;
      padding:6px 10px;
      background: #2b7a78;
      color: #fff;
      text-decoration:none;
      border-radius:6px;
      font-weight:600;
    }
    .attribution-compact {
      position: absolute;
      right: 8px;
      bottom: 8px;
      background: rgba(255,255,255,0.85);
      padding:6px 8px;
      border-radius:6px;
      font-size:12px;
      box-shadow:0 1px 4px rgba(0,0,0,0.2);
    }
    /* Artistic subtle vignette */
    #overlay-vignette {
      pointer-events:none;
      position: absolute;
      inset:0;
      background: radial-gradient(1200px 600px at 20% 30%, rgba(0,0,0,0.02), transparent 20%),
                  radial-gradient(1000px 500px at 80% 70%, rgba(0,0,0,0.03), transparent 25%);
    }
  </style>
</head>
<body>
  <div id="map"></div>
  <div id="overlay-vignette"></div>
  <div class="attribution-compact">Карта художнього стилю · натисніть на портрет → перейти</div>

  <!-- Leaflet JS -->
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
    integrity="sha512-somehash" crossorigin=""></script>

  <script>
  // === Налаштування авторів (ім'я, місце народження — рядок, посилання на презентацію, (необов.) url портрета) ===
  const authors = [
    { name: "Степан Миколайович Чарнецький", birthPlace: "Шманьківці, Тернопільська область, Україна", link: "https://sites.google.com/view/avtor5/%D0%B3%D0%BE%D0%BB%D0%BE%D0%B2%D0%BD%D0%B0-%D1%81%D1%82%D0%BE%D1%80%D1%96%D0%BD%D0%BA%D0%B0", img: "" },
    { name: "Олесь (Олександр) Йосипович Бабій", birthPlace: "Середня, Івано-Франківська область, Україна", link: "https://sites.google.com/view/avtor2/%D0%B3%D0%BE%D0%BB%D0%BE%D0%B2%D0%BD%D0%B0-%D1%81%D1%82%D0%BE%D1%80%D1%96%D0%BD%D0%BA%D0%B0", img: "" },
    { name: "Тарас Григорович Шевченко", birthPlace: "Моринці, Черкаська область, Україна", link: "https://sites.google.com/view/avtor3/%D0%B3%D0%BE%D0%BB%D0%BE%D0%B2%D0%BD%D0%B0-%D1%81%D1%82%D0%BE%D1%80%D1%96%D0%BD%D0%BA%D0%B0", img: "" },
    { name: "Іван Якович Франко", birthPlace: "Нагуєвичі, Львівська область, Україна", link: "https://sites.google.com/view/avtor1/%D0%B3%D0%BE%D0%BB%D0%BE%D0%B2%D0%BD%D0%B0-%D1%81%D1%82%D0%BE%D1%80%D1%96%D0%BD%D0%BA%D0%B0", img: "" },
    { name: "Андрій Якович Чайковський", birthPlace: "Самбір, Львівська область, Україна", link: "https://sites.google.com/view/avtor6/%D0%B3%D0%BE%D0%BB%D0%BE%D0%B2%D0%BD%D0%B0-%D1%81%D1%82%D0%BE%D1%80%D1%96%D0%BD%D0%BA%D0%B0", img: "" },
    { name: "Василь Андрійович Симоненко", birthPlace: "Біївці, Полтавська область, Україна", link: "https://sites.google.com/view/avtor7/%D0%B3%D0%BE%D0%BB%D0%BE%D0%B2%D0%BD%D0%B0-%D1%81%D1%82%D0%BE%D1%80%D1%96%D0%BD%D0%BA%D0%B0", img: "" },
    { name: "Валентина Матвіїв", birthPlace: "Львів, Україна", link: "https://sites.google.com/view/avtor8/%D0%B3%D0%BE%D0%BB%D0%BE%D0%B2%D0%BD%D0%B0-%D1%81%D1%82%D0%BE%D1%80%D1%96%D0%BD%D0%BA%D0%B0", img: "" },
    { name: "Ілля Чернілевський", birthPlace: "Київ, Україна", link: "https://sites.google.com/view/avtor9/%D0%B3%D0%BE%D0%BB%D0%BE%D0%B2%D0%BD%D0%B0-%D1%81%D1%82%D0%BE%D1%80%D1%96%D0%BD%D0%BA%D0%B0", img: "" },
    { name: "Володимир Кирилович Винниченко", birthPlace: "Єлисаветград (Кропивницький), Україна", link: "https://sites.google.com/view/avtor10/%D0%B3%D0%BE%D0%BB%D0%BE%D0%B2%D0%BD%D0%B0-%D1%81%D1%82%D0%BE%D1%80%D1%96%D0%BD%D0%BA%D0%B0", img: "" },
    { name: "Ліна Василівна Костенко", birthPlace: "Ржищів, Київська область, Україна", link: "https://sites.google.com/view/avtor11/%D0%B3%D0%BE%D0%BB%D0%BE%D0%B2%D0%BD%D0%B0-%D1%81%D1%82%D0%BE%D1%80%D1%96%D0%BD%D0%BA%D0%B0", img: "" },
    { name: "Оксана Петрівна Радушинська", birthPlace: "Старокостянтинів, Хмельницька область, Україна", link: "https://sites.google.com/view/avtor12/%D0%B3%D0%BE%D0%BB%D0%BE%D0%B2%D0%BD%D0%B0-%D1%81%D1%82%D0%BE%D1%80%D1%96%D0%BD%D0%BA%D0%B0", img: "" },
    { name: "Анатолій Андрійович Дімаров", birthPlace: "Миргород, Полтавська область, Україна", link: "https://sites.google.com/view/avtor13/%D0%B3%D0%BE%D0%BB%D0%BE%D0%B2%D0%BD%D0%B0-%D1%81%D1%82%D0%BE%D1%80%D1%96%D0%BD%D0%BA%D0%B0", img: "" },
    { name: "Григір Михайлович Тютюнник", birthPlace: "Шилівка, Полтавська область, Україна", link: "https://sites.google.com/view/avtor14/%D0%B3%D0%BE%D0%BB%D0%BE%D0%B2%D0%BD%D0%B0-%D1%81%D1%82%D0%BE%D1%80%D1%96%D0%BD%D0%BA%D0%B0", img: "" },
    { name: "Андрій Анатолійович Кокотюха", birthPlace: "Ніжин, Чернігівська область, Україна", link: "https://sites.google.com/view/avtor15/%D0%B3%D0%BE%D0%BB%D0%BE%D0%B2%D0%BD%D0%B0-%D1%81%D1%82%D0%BE%D1%80%D1%96%D0%BD%D0%BA%D0%B0", img: "" },
    { name: "Катерина Володимирівна Штанко", birthPlace: "Сімферополь, Автономна Республіка Крим, Україна", link: "https://sites.google.com/view/avtor16/%D0%B3%D0%BE%D0%BB%D0%BE%D0%B2%D0%BD%D0%B0-%D1%81%D1%82%D0%BE%D1%80%D1%96%D0%BD%D0%BA%D0%B0", img: "" },
    { name: "Наталка Малетич", birthPlace: "Львів, Україна", link: "https://sites.google.com/view/avtor18/%D0%B3%D0%BE%D0%BB%D0%BE%D0%B2%D0%BD%D0%B0-%D1%81%D1%82%D0%BE%D1%80%D1%96%D0%BD%D0%BA%D0%B0", img: "" },
    { name: "Олесь Бердник", birthPlace: "Вавилове, Миколаївська область, Україна", link: "https://sites.google.com/view/avtor19/%D0%B3%D0%BE%D0%BB%D0%BE%D0%B2%D0%BD%D0%B0-%D1%81%D1%82%D0%BE%D1%80%D1%96%D0%BD%D0%BA%D0%B0", img: "" },
    { name: "Галина Василівна Пагутяк (Москалець)", birthPlace: "Залокоть / Уріж, Львівська область, Україна", link: "https://sites.google.com/view/avtor20/%D0%B3%D0%BE%D0%BB%D0%BE%D0%B2%D0%BD%D0%B0-%D1%81%D1%82%D0%BE%D1%80%D1%96%D0%BD%D0%BA%D0%B0", img: "" }
  ];

  // === Ініціалізація карти з художньою плиткою Stamen Watercolor ===
  const map = L.map('map', { zoomControl:true }).setView([49.0, 32.0], 6);

  // Stamen Watercolor tiles (artistic)
  L.tileLayer('https://stamen-tiles.a.ssl.fastly.net/watercolor/{z}/{x}/{y}.jpg', {
    attribution: 'Map tiles by Stamen Design, CC BY 3.0 — Map data © OpenStreetMap contributors',
    maxZoom: 16
  }).addTo(map);

  // Функція для geocoding через Nominatim (OpenStreetMap)
  async function geocode(place) {
    const url = `https://nominatim.openstreetmap.org/search?format=json&q=${encodeURIComponent(place)}&limit=1&accept-language=uk`;
    try {
      const res = await fetch(url, { headers: { 'User-Agent': 'interactive-ukr-authors-map/1.0' } });
      if(!res.ok) throw new Error('geocode failure');
      const data = await res.json();
      if (data && data.length>0) return { lat: parseFloat(data[0].lat), lon: parseFloat(data[0].lon), display_name: data[0].display_name };
      return null;
    } catch (e) {
      console.warn("Geocode error:", place, e);
      return null;
    }
  }

  // Створення маркерів: якщо є img URL — використовуємо як іконку; інакше — ініціали
  function createIconFromImg(url, initials) {
    if (url && url.trim() !== "") {
      return L.divIcon({
        className: '',
        html: `<img class="marker-img" src="${url}" onerror="this.style.display='none'; this.parentNode.innerHTML='<div style=\\'width:54px;height:54px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-weight:700;background:#9b7bf0;color:#fff;\\'>${initials}</div>'" />`,
        iconSize: [54,54],
        iconAnchor: [27,54],
        popupAnchor: [0,-56]
      });
    } else {
      // іконка-ініціали
      const color = stringToColor(initials);
      return L.divIcon({
        className: '',
        html: `<div style="width:54px;height:54px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-weight:700;background:${color};color:#fff;border:3px solid rgba(255,255,255,0.9);box-shadow:0 2px 6px rgba(0,0,0,0.25)">${initials}</div>`,
        iconSize: [54,54],
        iconAnchor: [27,54],
        popupAnchor: [0,-56]
      });
    }
  }

  function stringToColor(str) {
    // простий хеш -> колір
    let h=0; for(let i=0;i<str.length;i++) h = str.charCodeAt(i) + ((h<<5)-h);
    const c = (h & 0x00FFFFFF).toString(16).toUpperCase();
    return '#' + '00000'.substring(0, 6 - c.length) + c;
  }

  function getInitials(name) {
    const parts = name.trim().split(/\s+/);
    if (parts.length === 1) return parts[0].substring(0,2).toUpperCase();
    return (parts[0][0] + (parts[1] ? parts[1][0] : '')).toUpperCase();
  }

  // Основна функція: геокодуємо та додаємо маркери
  (async function addAllMarkers() {
    for (const a of authors) {
      const place = a.birthPlace;
      const geo = await geocode(place);
      if (!geo) {
        console.warn('No coords for', a.name, 'place:', place);
        continue;
      }
      const initials = getInitials(a.name);
      const icon = createIconFromImg(a.img, initials);

      const marker = L.marker([geo.lat, geo.lon], { icon }).addTo(map);

      const popupHtml = `
        <div class="popup-card">
          <div class="popup-title">${a.name}</div>
          <div style="font-size:13px;color:#333">${geo.display_name}</div>
          <a class="goto-btn" href="${a.link}" target="_blank" rel="noopener">Відкрити презентацію</a>
        </div>`;

      marker.bindPopup(popupHtml, { maxWidth:260 });

      // трохи анімації: відкриваємо підказку при наведені (для десктоп)
      marker.on('mouseover', function() { if (!this._popup.isOpen()) this.openPopup(); });
      marker.on('mouseout', function() { if (this._popup.isOpen()) this.closePopup(); });
    }

    // Після додавання всіх маркерів — підганяємо zoom, щоб все вмістилось
    // (збираємо лангути)
    const allLayers = [];
    map.eachLayer(function(layer){
      try {
        if (layer.getLatLng) allLayers.push(layer.getLatLng());
      } catch(e){}
    });
    if (allLayers.length>0) {
      const latlngs = allLayers.map(p=>[p.lat,p.lng]);
      const b = L.latLngBounds(latlngs);
      map.fitBounds(b.pad(0.25));
    }
  })();

  </script>
</body>
</html>